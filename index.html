    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz9uD_erKui2gbXrunA-ub2r61_NaLHK75TnhHxAQewsjoGsvyzVeWL_NJ9z9lophzF/exec';
    const GOOGLE_CLIENT_ID = '190435721099-45et34v9elbvod5lb84ddakrnenh5039.apps.googleusercontent.com';

    let currentUser = null;
    let submittedTasks = new Set();
    let completedItems = {}; // ê°œì¸í™” ì™„ë£Œ í•­ëª© ì €ì¥ ê°ì²´
    const urlParams = new URLSearchParams(window.location.search);
    const isTeacherMode = urlParams.get('mode') === 'teacher';

    window.onload = function () {
        loadCompletedItems();
        google.accounts.id.initialize({ client_id: GOOGLE_CLIENT_ID, callback: handleCredentialResponse });
        const storedUser = localStorage.getItem('userInfo');
        if (storedUser) {
            currentUser = JSON.parse(storedUser);
            renderUserInfo(currentUser);
            loadData();
        } else {
            google.accounts.id.renderButton(document.getElementById("gsi-container"), { theme: "outline", size: "large", text: "signin_with", shape: "pill" });
            if (!isTeacherMode) {
                loadData();
            } else {
                document.getElementById('teacher-dashboard').style.display = 'block';
                document.getElementById('student-portal').style.display = 'none';
                document.getElementById('teacher-dashboard').innerHTML = '<div class="empty-state">êµì‚¬ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</div>';
            }
        }
        updateDateDisplay();
        setupEventListeners();
    };
    
    function loadCompletedItems() {
        const todayStr = new Date().toISOString().split('T')[0];
        const storedData = localStorage.getItem('completedItems');
        if (storedData) {
            const data = JSON.parse(storedData);
            if (data.date === todayStr) {
                completedItems = data.items || {};
            } else {
                localStorage.removeItem('completedItems');
            }
        }
    }

    function saveCompletedItems() {
        const todayStr = new Date().toISOString().split('T')[0];
        localStorage.setItem('completedItems', JSON.stringify({
            date: todayStr,
            items: completedItems
        }));
    }

    function setupEventListeners() {
        const goOutBtn = document.getElementById('request-go-out');
        if (goOutBtn) goOutBtn.addEventListener('click', () => openLeaveModal('ì™¸ì¶œ'));
        
        const earlyLeaveBtn = document.getElementById('request-early-leave');
        if(earlyLeaveBtn) earlyLeaveBtn.addEventListener('click', () => openLeaveModal('ì¡°í‡´'));

        const closeModalBtn = document.getElementById('closeModal');
        if(closeModalBtn) closeModalBtn.addEventListener('click', () => document.getElementById('modal-overlay').style.display = 'none');

        const submitLeaveBtn = document.getElementById('submitLeave');
        if(submitLeaveBtn) submitLeaveBtn.addEventListener('click', submitLeaveRequest);
    }

    function openLeaveModal(type) {
        document.getElementById('modal-title').textContent = `${type} ì‹ ì²­`;
        document.getElementById('leave-type').value = type;
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('leave-date').value = today;
        document.getElementById('leave-reason').value = '';
        document.getElementById('modal-overlay').style.display = 'flex';
    }
    
    async function handleCredentialResponse(response) {
        const userObject = JSON.parse(atob(response.credential.split('.')[1]));
        currentUser = { name: userObject.name, email: userObject.email, picture: userObject.picture, studentId: null, isTeacher: false };
        localStorage.setItem('userInfo', JSON.stringify(currentUser));
        location.reload();
    }

    function handleLogout() {
        localStorage.removeItem('userInfo');
        currentUser = null;
        google.accounts.id.disableAutoSelect();
        location.reload();
    }

    function renderUserInfo(user) {
        const displayEl = document.getElementById('user-display');
        const gsiContainer = document.getElementById('gsi-container');
        if(!displayEl || !gsiContainer) return;
        displayEl.style.display = 'block';
        gsiContainer.style.display = 'none';
        let userInfoHtml = `<span class="user-info"><img src="${user.picture}" alt="profile"><strong>${user.name}</strong>ë‹˜ <a href="#" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</a></span>`;
        if (user.studentId === null && !user.isTeacher) {
            userInfoHtml += ` <span class="user-info" style="color: #ffc107;">(ë¯¸ë“±ë¡)</span>`;
        }
        displayEl.innerHTML = userInfoHtml;
    }

    async function loadData() {
        let fullUrl = `${SCRIPT_URL}?v=${new Date().getTime()}`;
        if (isTeacherMode) {
            document.getElementById('portal-title').textContent = 'ğŸ“ êµì‚¬ í†µí•© ëŒ€ì‹œë³´ë“œ';
            fullUrl += '&mode=teacher';
        }
        if (currentUser) {
            fullUrl += `&email=${encodeURIComponent(currentUser.email)}`;
        }

        const studentPortal = document.getElementById('student-portal');
        const teacherDashboard = document.getElementById('teacher-dashboard');

        if (isTeacherMode) {
            studentPortal.style.display = 'none';
            teacherDashboard.style.display = 'block';
            document.getElementById('teacher-admin-section').innerHTML = '';
            document.getElementById('assignment-status').innerHTML = '<div class="empty-state">ğŸ”„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            document.getElementById('pending-leave-requests').innerHTML = '<div class="empty-state">ğŸ”„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            document.getElementById('teacher-links').innerHTML = '<div class="empty-state">ğŸ”„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
        } else {
            studentPortal.style.display = 'block';
            teacherDashboard.style.display = 'none';
            ['notices', 'tasks', 'resources', 'leave-requests'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = '<div class="empty-state">ğŸ”„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            });
        }
        
        try {
            const response = await fetch(fullUrl);
            if (!response.ok) throw new Error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
            const data = await response.json();
            
            if (data.error) {
                if (isTeacherMode) teacherDashboard.innerHTML = `<div class="empty-state">âŒ ${data.error}</div>`;
                else studentPortal.innerHTML = `<div class="empty-state">âŒ ${data.error}</div>`;
                if(data.user) { currentUser.name = data.user.name; renderUserInfo(currentUser); }
                return;
            }

            currentUser = { ...currentUser, ...data.user };
            localStorage.setItem('userInfo', JSON.stringify(currentUser));
            renderUserInfo(currentUser);

            if (isTeacherMode) {
                renderTeacherDashboard(data);
            } else {
                if (data.user && data.user.studentId) {
                    document.getElementById('leave-section').style.display = 'block';
                } else {
                    document.getElementById('leave-section').style.display = 'none';
                }
                
                submittedTasks = new Set(data.submittedTasks || []);
                renderItems('notices', data.notices.filter(item => !completedItems[item.id]), 'ìì„¸íˆ ë³´ê¸° â†’');
                renderItems('tasks', data.tasks.filter(item => !completedItems[item.id]), 'ë°”ë¡œ í•˜ê¸° â†’', true);
                renderUnsubmitted(data.unsubmitted);
                renderResources(data.resources);
                renderLeaveRequests(data.leaveRequests);
            }

        } catch (error) {
            console.error('Error fetching data:', error);
            const targetEl = isTeacherMode ? teacherDashboard : document.getElementById('notices');
            targetEl.innerHTML = `<div class="empty-state">âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨! (${error.message})</div>`;
        }
    }
    
    async function completeItem(itemId, isTeacherAction = false, rowNum, sheetName) {
        const itemElement = document.getElementById(itemId);
        if (!itemElement) return;

        if (isTeacherAction) {
            const colName = (sheetName === '[ë°ì´í„°_ì•Œë¦¼]') ? 'ê²Œì‹œì—¬ë¶€' : 'ìƒíƒœ';
            const value = (sheetName === '[ë°ì´í„°_ì•Œë¦¼]') ? 'N' : 'ì™„ë£Œ';
            const params = new URLSearchParams({ action: 'updateTaskStatus', sheetName, rowNum, colName, value });
            try {
                const res = await fetch(`${SCRIPT_URL}?${params.toString()}`);
                const result = await res.json();
                if (result.status !== 'success') throw new Error(result.message);
            } catch (err) {
                alert(`í•­ëª© ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ${err.message}`);
                return;
            }
        } else {
            completedItems[itemId] = true;
            saveCompletedItems();
        }

        itemElement.style.transition = 'opacity 0.5s, transform 0.5s';
        itemElement.style.opacity = '0';
        itemElement.style.transform = 'translateX(-50px)';
        setTimeout(() => itemElement.remove(), 500);
    }

    async function handleSubmission(item) {
        if (!currentUser || !currentUser.studentId) return; 
        if (submittedTasks.has(item.taskId)) return; 
        const params = new URLSearchParams({ action: 'logClick', studentId: currentUser.studentId, name: encodeURIComponent(currentUser.name), taskId: encodeURIComponent(item.taskId) });
        try {
            const response = await fetch(`${SCRIPT_URL}?${params.toString()}`);
            const result = await response.json();
            if (result.status === 'success') {
                submittedTasks.add(item.taskId);
            }
        } catch (error) { console.error('ì œì¶œ ê¸°ë¡ ì˜¤ë¥˜:', error); }
    }

    function renderItems(containerId, items, defaultButtonText, isTask = false) {
        const container = document.getElementById(containerId);
        if (!items || items.length === 0) {
            container.innerHTML = `<div class="empty-state">${containerId === 'notices' ? 'ğŸ“ ì˜¤ëŠ˜ ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.' : 'âœ… ì˜¤ëŠ˜ í•  ì¼ì´ ëª¨ë‘ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!'}</div>`;
            return;
        }
        container.innerHTML = items.map(item => {
            let completeButton = '';
            if (item.type !== 'ê³µì§€' && currentUser && currentUser.studentId) { // í•™ìƒì€ ê³µì§€ ì™„ë£Œ ë¶ˆê°€
                 completeButton = `<button class="complete-btn" title="í™•ì¸/ì™„ë£Œ" onclick="completeItem('${item.id}')">âœ”</button>`;
            }
            if (isTeacherMode) { // êµì‚¬ëŠ” ëª¨ë“  í•­ëª©ì„ ê²Œì‹œ ì¢…ë£Œ ê°€ëŠ¥
                completeButton = `<button class="teacher-complete-btn" title="ê²Œì‹œ ì¢…ë£Œ" onclick="completeItem('${item.id}', true, ${item.rowNum}, '[ë°ì´í„°_ì•Œë¦¼]')">âœ–</button>`;
            }

            const icon = item.icon ? `<span class="icon">${item.icon}</span> ` : '';
            const title = item.title ? `<div class="notice-title">${icon}${item.title}</div>` : '';
            let contentHtml = '';
            
            const isChecklist = isTask && (item.type === 'ì²´í¬ë¦¬ìŠ¤íŠ¸' || (!item.link && item.content.includes(',')));

            if (isChecklist && item.taskId) {
                const subtasks = item.content.split(',').map(s => s.trim());
                contentHtml = `<ul class="subtask-list">` + subtasks.map(subtask => {
                    const fullTaskId = `${item.taskId}_${subtask}`;
                    const isCompleted = submittedTasks.has(fullTaskId);
                    return `<li class="subtask-item ${isCompleted ? 'completed' : ''}"><input type="checkbox" class="subtask-checkbox" onchange="toggleSubtask(this, '${item.taskId}', '${subtask}')" ${isCompleted ? 'checked' : ''}><label class="subtask-label">${subtask}</label></li>`;
                }).join('') + `</ul>`;
            } else {
                const image = item.imageUrl ? `<img src="${item.imageUrl}" alt="${item.title || 'ì•Œë¦¼ ì´ë¯¸ì§€'}" class="notice-image">` : '';
                const content = item.content ? `<div class="notice-content">${!title && !image ? icon : ''}${item.content.replace(/\n/g, '<br>')}</div>` : '';
                let finalLink = item.link;

                if (isTask && finalLink && finalLink.includes('__STUDENT_ID__')) {
                    if (currentUser && currentUser.studentId) {
                        finalLink = finalLink.replace('__STUDENT_ID__', currentUser.studentId).replace('__STUDENT_NAME__', encodeURIComponent(currentUser.name));
                    } else { finalLink = null; }
                }
                
                let linkHtml = '';
                if (finalLink) {
                    const clickHandler = item.recordable ? `onclick="handleSubmission({taskId: '${item.taskId}'})"` : '';
                    linkHtml = `<a href="${finalLink}" class="notice-link" target="_blank" ${clickHandler}>${item.buttonText || defaultButtonText}</a>`;
                }
                contentHtml = image + content + linkHtml;
            }
            return `<div class="notice-item" id="${item.id}">${completeButton}${title}${contentHtml}</div>`;
        }).join('');
    }

    async function toggleSubtask(checkbox, taskId, subtask) {
        if (!currentUser || !currentUser.studentId) { alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”."); checkbox.checked = !checkbox.checked; return; }
        const isChecked = checkbox.checked;
        const listItem = checkbox.closest('.subtask-item');
        listItem.style.opacity = '0.5';
        const params = new URLSearchParams({ action: 'logSubtask', studentId: currentUser.studentId, name: currentUser.name, taskId: taskId, subtask: subtask, isChecked: isChecked });
        try {
            const response = await fetch(`${SCRIPT_URL}?${params.toString()}`);
            const result = await response.json();
            if (result.status !== 'success') throw new Error(result.message);
            listItem.classList.toggle('completed', isChecked);
            const fullTaskId = `${taskId}_${subtask}`;
            if (isChecked) submittedTasks.add(fullTaskId); else submittedTasks.delete(fullTaskId);
        } catch (error) {
            alert(`ì˜¤ë¥˜: ${error.message}`); checkbox.checked = !isChecked;
        } finally { listItem.style.opacity = '1'; }
    }
    
    function renderUnsubmitted(tasks) { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
    function renderWidgets(widgets) { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
    function renderResources(resources) { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
    function renderLeaveRequests(requests) { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
    async function submitLeaveRequest() { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
    
    function renderTeacherDashboard(data) {
        const adminSection = document.getElementById('teacher-admin-section');
        adminSection.innerHTML = `<div class="section"><div class="section-title"><span class="icon">âš™ï¸</span>ê´€ë¦¬ì ë„êµ¬</div><div class="teacher-dashboard-grid"><a href="${data.sheetUrl}" target="_blank" class="teacher-card"><div class="teacher-card-title">ğŸ“Š ë°ì´í„° ì‹œíŠ¸ ìˆ˜ì •</div><p>ì•Œë¦¼, ìœ„ì ¯, ìë£Œì‹¤ ë“± ëª¨ë“  ë°ì´í„°ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.</p></a><div class="teacher-card form-creator"><input type="text" id="new-form-title" placeholder="ìƒˆ êµ¬ê¸€í¼ ê³¼ì œ ì œëª©"><button onclick="createFormAssignment(event)">ìƒì„±</button></div></div></div>`;
        
        const routineContainer = document.getElementById('routine-tasks-section');
        const today = new Date();
        const dayOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][today.getDay()];
        const todayRoutines = data.routines.filter(r => {
            if (!r.condition) return false;
            const conditions = r.condition.split(',').map(s=>s.trim());
            if (conditions.includes('ì£¼ì¤‘') && (dayOfWeek === 'í† ' || dayOfWeek === 'ì¼')) return false;
            if (conditions.includes('ì£¼ë§') && !(dayOfWeek === 'í† ' || dayOfWeek === 'ì¼')) return false;
            if (conditions.includes('ë§¤ì¼')) return true;
            return conditions.includes(dayOfWeek);
        });

        if (todayRoutines.length > 0) {
            routineContainer.innerHTML = `<div class="section-title"><span class="icon">ğŸŒŸ</span>ì˜¤ëŠ˜ì˜ ë£¨í‹´ ì—…ë¬´</div>` + 
            todayRoutines.map(r => `
                <div class="routine-item ${completedItems[r.id] ? 'completed' : ''}" id="${r.id}">
                    <input type="checkbox" id="check-${r.id}" onchange="toggleRoutineComplete('${r.id}')" ${completedItems[r.id] ? 'checked' : ''}>
                    <label for="check-${r.id}">${r.title}</label>
                </div>
            `).join('');
        } else {
            routineContainer.innerHTML = '';
        }

        const assignmentContainer = document.getElementById('assignment-status');
        if(data.assignments && data.assignments.length > 0){
            assignmentContainer.innerHTML = data.assignments.map(a => {
                const checkButton = (a.assignmentType === 'ë‹¨ì¼ì œì¶œ') 
                    ? `<button class="check-btn" onclick="checkUnsubmitted(event, '${a.taskId}', '${a.title}', '${a.studentIdColumn}')">ë¯¸ì œì¶œì í™•ì¸</button>`
                    : '';
                const responseButton = a.responseSheetUrl ? `<a href="${a.responseSheetUrl}" target="_blank"><button class="response-btn">ì‘ë‹µ í™•ì¸</button></a>` : '';
                const completeButton = `<button class="teacher-complete-btn" title="ëª©ë¡ì—ì„œ ìˆ¨ê¸°ê¸°" onclick="completeItem('${a.id}', true, ${a.rowNum}, '[ë°ì´í„°_ì•Œë¦¼]')">âœ–</button>`;

                return `<div class="assignment-card" id="${a.id}">
                            ${completeButton}
                            <div class="notice-title">${a.title}</div>
                            <div class="assignment-actions">
                                ${responseButton}
                                ${checkButton}
                            </div>
                        </div>`
            }).join('');
        } else {
            assignmentContainer.innerHTML = '<div class="empty-state">í™•ì¸í•  ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        }

        const tabsContainer = document.getElementById('teacher-tabs-container');
        const linksContainer = document.getElementById('teacher-links');
        const tabs = Object.keys(data.dashboardItems);
        tabsContainer.innerHTML = tabs.map(tab => `<button class="tab-btn" onclick="filterTeacherTasks('${tab}')">${tab}</button>`).join('');
        
        window.filterTeacherTasks = (selectedTab) => {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            linksContainer.innerHTML = `<div class="teacher-dashboard-grid">` + 
            data.dashboardItems[selectedTab].map(item => `
                <div class="teacher-card" id="${item.id}">
                    <button class="teacher-complete-btn" title="ì™„ë£Œ ì²˜ë¦¬" onclick="completeItem('${item.id}', true, ${item.rowNum}, '[êµì‚¬_ëŒ€ì‹œë³´ë“œ]')">âœ”</button>
                    <div class="teacher-card-title">${item.title}</div>
                    <p>${item.description}</p>
                    ${item.url ? `<a href="${item.url}" target="_blank" class="teacher-card-button">${item.buttonText || 'ë°”ë¡œê°€ê¸°'}</a>` : ''}
                </div>
            `).join('') + `</div>`;
        };

        if (tabs.length > 0) {
            document.querySelector('.tab-btn').click(); // ì²« ë²ˆì§¸ íƒ­ì„ ê¸°ë³¸ìœ¼ë¡œ í™œì„±í™”
        } else {
            linksContainer.innerHTML = '<div class="empty-state">ë“±ë¡ëœ ê´€ë¦¬ ì‹œìŠ¤í…œì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }

        const pendingContainer = document.getElementById('pending-leave-requests');
        if (!data.pendingLeaveRequests || data.pendingLeaveRequests.length === 0) {
            pendingContainer.innerHTML = '<div class="empty-state">í™•ì¸ ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        } else {
            pendingContainer.innerHTML = data.pendingLeaveRequests.map(req => `<div class="teacher-leave-card"><strong>${req.ì´ë¦„} (${req.í•™ë²ˆ})</strong> - ${req.ì‹ ì²­ì¢…ë¥˜} (${new Date(req.í¬ë§ì¼ì).toLocaleDateString()})<p>ì‚¬ìœ : ${req.ì‚¬ìœ }</p><input type="text" id="comment-${req.rowNum}" class="leave-comment-input" placeholder="ì½”ë©˜íŠ¸ (ì„ íƒ ì‚¬í•­)"><div class="leave-actions"><button class="approve-btn" onclick="updateLeaveStatus(${req.rowNum}, 'ìŠ¹ì¸', 'comment-${req.rowNum}')">ìŠ¹ì¸</button><button class="reject-btn" onclick="updateLeaveStatus(${req.rowNum}, 'ë°˜ë ¤', 'comment-${req.rowNum}')">ë°˜ë ¤</button></div></div>`).join('');
        }
    }

    function toggleRoutineComplete(itemId) {
        const checkbox = document.getElementById(`check-${itemId}`);
        const itemElement = document.getElementById(itemId);
        if (checkbox.checked) {
            completedItems[itemId] = true;
        } else {
            delete completedItems[itemId];
        }
        saveCompletedItems();
        itemElement.classList.toggle('completed', checkbox.checked);
    }
    
    async function checkUnsubmitted(event, taskId, taskTitle, studentIdColumn) {
        const button = event.target; button.disabled = true;
        const params = new URLSearchParams({ action: 'getUnsubmittedStudents', taskId: taskId, studentIdColumn: studentIdColumn });
        try {
            const res = await fetch(`${SCRIPT_URL}?${params.toString()}`);
            const result = await res.json();
            if (result.status !== 'success') throw new Error(result.message);
            let message = `[${taskTitle}] ë¯¸ì œì¶œ í•™ìƒ:\n\n`;
            if (result.students.length === 0) {
                message = `[${taskTitle}]\n\nëª¨ë“  í•™ìƒì´ ì œì¶œì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!`;
            } else {
                message += result.students.map(s => `${s.name} (${s.id})`).join('\n');
            }
            alert(message);
        } catch (error) { alert('ë¯¸ì œì¶œì í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
        } finally { button.disabled = false; }
    }

    async function updateLeaveStatus(rowNum, status, commentInputId) {
        const commentEl = document.getElementById(commentInputId);
        const comment = commentEl ? commentEl.value : '';
        const params = new URLSearchParams({ action: 'updateLeaveStatus', rowNum, status, comment: comment });
        try {
            const res = await fetch(`${SCRIPT_URL}?${params.toString()}`);
            const result = await res.json();
            if (result.status === 'success') { alert(`${status} ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`); loadData(); } 
            else { throw new Error(result.message); }
        } catch (error) { alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message); }
    }
    
    async function createFormAssignment(event) {
        const title = document.getElementById('new-form-title').value;
        if (!title) { alert('ê³¼ì œ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        const button = event.target; button.disabled = true; button.textContent = 'ìƒì„± ì¤‘...';
        const params = new URLSearchParams({ action: 'createFormAssignment', title: title });
        try {
            const res = await fetch(`${SCRIPT_URL}?${params.toString()}`);
            const result = await res.json();
            if (result.status === 'success') {
                alert(result.message);
                document.getElementById('new-form-title').value = '';
                loadData();
            } else { throw new Error(result.message); }
        } catch(error) { alert('í¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
        } finally { button.disabled = false; button.textContent = 'ìƒì„±'; }
    }
    
    function updateDateDisplay() {
        document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
    }

</script>
</html>
